@model PagedList.IPagedList<ViSED.Models.Tasks>
@using PagedList.Mvc
@{
    Layout = null;
    ViSED.Models.ViSedDBEntities vsdEnt = new ViSED.Models.ViSedDBEntities();
    var myAccount = (from u in vsdEnt.Accounts
                     where u.login == User.Identity.Name
                     select u).FirstOrDefault();
}
<table class="table_col">

    @if (ViewBag.Type == "zadachi")
    {
        <tr>
            <th>Поручитель</th>
            <th>Название задачи</th>
            <th>Текст задачи</th>
            <th>Дата</th>
            <th>Срок</th>
            <th>Вид задачи</th>
            <th>Приложения</th>
            <th>Завершено</th>
            <th></th>
        </tr>

        foreach (ViSED.Models.Tasks item in Model)
        {
            var _taskAttachments = from t in vsdEnt.TaskAttachments
                                   where t.id == item.id
                                   select t;
            <tr>
                @if (item.user_id_from != null)
                {
                    <td>@item.Users.first_name @item.Users.second_name.Substring(0, 1). @item.Users.third_name.Substring(0, 1).</td>
                }
                else
                {
                    <td>Я</td>
                }
                @if (item.id_letter != null)
                {
                    <td>@Html.ActionLink(item.taskName, "DocView", "User", new { doc_id = item.id_letter }, null)</td>
                }
                else
                {
                    <td>@item.taskName</td>
                }
                <td>@item.taskText</td>
                <td>@item.dateOfCreate.ToShortDateString()</td>
                @if (item.dateDeadline == null)
                {
                    <td>Нет срока</td>
                }
                else
                {
                    <td>@item.dateDeadline</td>
                }
                @if (item.taskType == 1)
                {
                    
                    <td>Для исполнения</td>
                }
                else
                {
                    <td>Для ознакомления</td>
                }
                <td>
                    @if (_taskAttachments != null)
                    {
                        foreach (ViSED.Models.TaskAttachments t in _taskAttachments)
                        {
                            <a href="@Url.Content(t.attachedFile)">@t.attachedName</a><br />
                        }
                    }
                    else
                    {

                    }
                </td>
                @if (item.complete == true)
                {
                    string str = item.taskType == 1 ? "Исполнено" : "Ознакомлен";
                    <td>@str</td>
                }
                else
                {
                    string str = item.taskType == 1 ? "Не исполнено" : "Не ознакомлен";
                    <td>@str</td>
                }
                @if (item.complete != true)
                {
                    <td> @Html.ActionLink("Завершить", "TaskCompleate", "Task", new { id = item.id }, null) </td>
                }
                else
                {
                    if (item.user_id_from == null && item.user_id_to == myAccount.user_id)
                    {
                        <td>@Html.ActionLink("Удалить", "TaskDelete", "Task", new { id = item.id }, null)</td>
                    }
                }
                
            </tr>
        }
    }
    else
    {
        <tr>
            <th>Отвественный</th>
            <th>Название задачи</th>
            <th>Текст задачи</th>
            <th>Дата</th>
            <th>Срок</th>
            <th>Приложения</th>
            <th>Вид задачи</th>
            <th>Завершено</th>
            <th></th>
        </tr>
        foreach (ViSED.Models.Tasks item in Model)
        {
            var _taskAttachments = from t in vsdEnt.TaskAttachments
                                   where t.id == item.id
                                   select t;
            <tr>
                <td>@item.Users1.first_name @item.Users1.second_name.Substring(0, 1). @item.Users1.third_name.Substring(0, 1).</td>
                @if (item.taskName !=null && item.id_letter!=null)
                {
                    <td>@Html.ActionLink(item.taskName, "DocView","User",new {doc_id=item.id_letter},null)</td>
                }
                else
                {
                    <td>@item.taskName</td>
                }
                <td>@item.taskText</td>
                <td>@item.dateOfCreate.ToShortDateString()</td>
                @if (item.dateDeadline == null)
                {
                    <td>Нет срока</td>
                }
                else
                {
                    <td>@item.dateDeadline</td>
                }

                @if (item.taskType == 1)
                {
                    <td>Для исполнения</td>
                }
                else
                {
                    <td>Для ознакомления</td>
                }
                <td>
                    @if (_taskAttachments != null)
                    {
                        foreach (ViSED.Models.TaskAttachments t in _taskAttachments)
                        {
                            <a href="@Url.Content(t.attachedFile)">@t.attachedName</a><br />
                        }
                    }
                    else
                    {
                        
                    }

                </td>
                @if (item.complete == true)
                {
                    string str = item.taskType == 1 ? "Исполнено" : "Ознакомлен";
                    <td>@str</td>
                }
                else
                {
                    string str = item.taskType == 1 ? "Не исполнено" : "Не ознакомлен";
                    <td>@str</td>
                }
                <td>@Html.ActionLink("Удалить", "TaskDelete", "Task", new { id = item.id }, null)</td>
            </tr>
        }
    }
</table>
<div style="text-align: center;">
    @Html.PagedListPager(Model, page => Url.Action("TasksList", "Task", new { page = page, taskVid=ViewBag.Type }, null),
new PagedListRenderOptions
{
    LinkToFirstPageFormat = "<<",
    LinkToPreviousPageFormat = "Назад",
    LinkToNextPageFormat = "Вперед",
    LinkToLastPageFormat = ">>"
})
</div>


